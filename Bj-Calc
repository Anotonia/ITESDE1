<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北京市养老金动态估算器</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用 Inter 和 Noto Sans SC 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            /* 平滑滚动 */
            scroll-behavior: smooth;
        }
        /* 自定义滑块样式 */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e5e7eb; /* bg-gray-200 */
            border-radius: 9999px; /* rounded-full */
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #3b82f6; /* bg-blue-600 */
            border-radius: 9999px; /* rounded-full */
            border: 4px solid white;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #3b82f6; /* bg-blue-600 */
            border-radius: 9999px; /* rounded-full */
            border: 4px solid white;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100" onload="calculatePension()">

    <div class="container max-w-7xl mx-auto p-4 md:p-8">
        
        <!-- 1. 标题 -->
        <h1 class="text-3xl md:text-4xl font-bold text-center text-blue-800 mb-4">
            北京市养老金动态估算器
        </h1>
        <p class="text-center text-gray-600 mb-10">（基于65岁退休的统一模型）</p>

        <!-- 2. 主体布局：左侧参数，右侧结果 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <!-- ======================= -->
            <!--   左侧：参数调整面板     -->
            <!-- ======================= -->
            <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-xl h-fit md:sticky top-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">参数调整</h2>

                <!-- 参数0：出生年份 -->
                <div class="mb-6">
                    <label for="birthYear" class="block text-sm font-bold text-gray-700 mb-2">出生年份</label>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-600">从1970年到2000年</span>
                        <span id="birthYearValue" class="text-xl font-bold text-blue-600">1987 年</span>
                    </div>
                    <input type="range" id="birthYear" min="1970" max="2000" value="1987" step="1" class="w-full" oninput="updateSliderValue('birthYear'); calculatePension();">
                </div>

                <!-- 参数1：未来缴费年限 -->
                <div class="mb-6">
                    <label for="years" class="block text-sm font-bold text-gray-700 mb-2">未来缴费年限 (从2026年起)</label>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-600">从9年到34年</span>
                        <span id="yearsValue" class="text-xl font-bold text-blue-600">20 年</span>
                    </div>
                    <input type="range" id="years" min="9" max="34" value="20" step="1" class="w-full" oninput="updateSliderValue('years'); calculatePension();">
                </div>

                <!-- 参数2：缴费指数 -->
                <div class="mb-6">
                    <label for="index" class="block text-sm font-bold text-gray-700 mb-2">平均缴费指数</label>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-600">0.6 (最低) - 3.0 (最高)</span>
                        <span id="indexValue" class="text-xl font-bold text-blue-600">0.6</span>
                    </div>
                    <input type="range" id="index" min="0.6" max="3.0" value="0.6" step="0.1" class="w-full" oninput="updateSliderValue('index'); calculatePension();">
                </div>

                <!-- 参数3：未来工资增长率 -->
                <div class="mb-8">
                    <label for="growth" class="block text-sm font-bold text-gray-700 mb-2">未来工资年增长率 (假设)</label>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-600">3% (保守) - 8% (乐观)</span>
                        <span id="growthValue" class="text-xl font-bold text-blue-600">5.0 %</span>
                    </div>
                    <input type="range" id="growth" min="3" max="8" value="5" step="0.1" class="w-full" oninput="updateSliderValue('growth'); calculatePension();">
                </div>

                <!-- 固定的假设 -->
                <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">固定假设</h4>
                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                        <li>退休年龄: <strong>65岁</strong></li>
                        <li id="retirementYearText">退休年份: <strong>2052年</strong></li>
                        <li>已缴年限: <strong>6 年</strong></li>
                        <li>未来缴费起始: <strong>2026 年</strong></li>
                        <li id="totalYearsText">总缴费年限: <strong>26 年</strong></li>
                        <li>计发月数: <strong>101</strong> 个月</li>
                        <li>2024年社平工资 (SAW): <strong>11,937 元/月</strong></li>
                        <li id="currentBaseText">当前缴费基数 (估算): <strong>7,162.20 元/月</strong></li>
                    </ul>
                </div>
            </div>

            <!-- ======================= -->
            <!--   右侧：估算结果展示     -->
            <!-- ======================= -->
            <div class="md:col-span-2 space-y-8">
                
                <!-- 结果卡片 1：静态估算 -->
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">静态估算 (按2025年购买力)</h2>
                    <p class="text-gray-600 mb-6">假设您今天就退休了，用来衡量养老金在当下的价值。</p>
                    
                    <div class="text-center mb-6">
                        <span class="text-lg text-gray-700">每月总额 (A + B)</span>
                        <p id="staticTotal" class="text-4xl md:text-5xl font-extrabold text-indigo-700 my-2">3,271.40 元</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-bold text-indigo-900">A. 基础养老金 (统筹)</h4>
                            <p id="staticBase" class="text-2xl font-semibold text-indigo-700 mt-1">1,909.92 元/月</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                            <h4 class="font-bold text-indigo-900">B. 个人账户养老金</h4>
                            <p id="staticPersonal" class="text-2xl font-semibold text-indigo-700 mt-1">1,361.48 元/月</p>
                        </div>
                    </div>
                </div>

                <!-- 结果卡片 2：动态估算 -->
                <div class="bg-blue-50 p-6 md:p-8 rounded-2xl shadow-xl border-2 border-blue-200">
                    <h2 class="text-2xl font-bold text-blue-900 mb-1">动态估算 (<span id="dynamicYearText">2052</span>年实际金额)</h2>
                    <p class="text-blue-800 mb-6">推测在您退休时，银行卡上实际收到的月度金额。</p>
                    
                    <div class="text-center mb-6">
                        <span class="text-lg text-blue-900">每月总额 (A + B)</span>
                        <p id="dynamicTotal" class="text-4xl md:text-5xl font-extrabold text-blue-700 my-2">12,203.80 元</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h4 class="font-bold text-gray-700">A. 基础养老金 (统筹)</h4>
                            <p id="dynamicBase" class="text-2xl font-semibold text-blue-700 mt-1">7,124.81 元/月</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <h4 class="font-bold text-gray-700">B. 个人账户养老金</h4>
                            <p id="dynamicPersonal" class="text-2xl font-semibold text-blue-700 mt-1">5,078.99 元/月</p>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <span class="text-sm text-gray-600">届时 (<span id="dynamicSAWYearText">2051</span>年) 的社会平均工资 (SAW) 预测为</span>
                        <p id="dynamicSAW" class="text-2xl font-bold text-gray-800">~ 44,530.01 元/月</p>
                    </div>
                </div>

                <!-- 结果卡片 3：核心结论 -->
                <div class="bg-red-50 border-l-4 border-red-500 p-6 md:p-8 rounded-lg">
                    <h2 class="text-2xl font-bold text-red-900 mb-4">核心结论：养老金替代率</h2>
                    
                    <div class="text-center my-6">
                        <p id="replacementRate" class="text-6xl font-extrabold text-red-700">27.4 %</p>
                    </div>
                    
                    <p class="text-red-800 space-y-3" id="interpretation">
                        <strong>解读：</strong>您在2052年领取的 <strong>12,203.80 元</strong>，其购买力大致相当于今天的 <strong>3,271.40 元</strong>。
                        <br>
                        这个比率 (27.4%) 是您养老金水平与社会平均工资的对比。国际劳工组织建议的警戒线为55%。
                    </p>
                </div>

                <!-- 结果卡片 4：估算总缴费成本 -->
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">四、 估算总缴费成本 (非官方)</h2>
                    <p class="text-gray-600 mb-6">
                        基于 <span class="font-bold text-blue-600">未来</span> 缴费 <span id="costYears" class="font-bold text-blue-600">20</span> 年、平均指数 <span id="costIndex" class="font-bold text-blue-600">0.6</span>、年增 <span id="costGrowth" class="font-bold text-blue-600">5.0</span>% 的假设。
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center">
                            <h4 class="font-bold text-gray-700">企业员工 (五险总额)</h4>
                            <p class="text-sm text-gray-500">(含单位与个人部分)</p>
                            <p id="totalCostEnterprise" class="text-3xl font-bold text-gray-900 mt-2">~ 155.4 万</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center">
                            <h4 class="font-bold text-gray-700">灵活就业 (养老+医疗)</h4>
                            <p class="text-sm text-gray-500">(养老20% + 医疗~8% 估算)</p>
                            <p id="totalCostFlexible" class="text-3xl font-bold text-gray-900 mt-2">~ 84.0 万</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">
                        <strong>重要提示：</strong> 此处 "企业员工" 成本基于 <strong>37.04%</strong> 的五险总比例 (源自 2652.92 / 7162)，"灵活就业" 按 <strong>28%</strong> (养老20%+医疗8%) 的估算比例。此估算高度简化，仅供参考。
                    </p>
                </div>

                <!-- 结果卡片 5：估算回本时间 -->
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">五、 估算回本时间 (非官方)</h2>
                    <p class="text-gray-600 mb-6">
                        (未来总缴费成本 ÷ 静态估算月领 <span id="paybackAmount" class="font-bold text-indigo-700">3,271</span> 元)
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center">
                            <h4 class="font-bold text-gray-700">企业员工 (五险)</h4>
                            <p class="text-sm text-gray-500">(领养老金回本时间)</p>
                            <p id="paybackEnterprise" class="text-3xl font-bold text-gray-900 mt-2">~ 12.7 年</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center">
                            <h4 class="font-bold text-gray-700">灵活就业 (养老+医疗)</h4>
                            <p class="text-sm text-gray-500">(领养老金回本时间)</p>
                            <p id="paybackFlexible" class="text-3xl font-bold text-gray-900 mt-2">~ 6.9 年</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">
                        <strong>重要提示：</strong> 此估算未考虑利息、个人账户余额、以及退休后养老金的年度增长，是一个极简的参考模型。
                    </p>
                </div>
                
                <p class="text-center text-xs text-gray-400 pt-6">
                    免责声明：本估算器基于大量简化假设，仅供个人参考，不构成任何财务建议。
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- 固定的常量 ---
        const CURRENT_SAW = 11937;     // 2024年社平工资
        const RETIREMENT_AGE = 65;
        const PENSION_FACTOR = 101;    // 65岁退休计发月数
        const RATE_ENTERPRISE = 0.3704; // 37.04%, 基于 2652.92 / 7162 (来自原静态报告)
        const RATE_FLEXIBLE = 0.28;   // 28% 估算 (养老 20% + 医疗 8%)
        const ALREADY_PAID_YEARS = 6;   // 假设已缴6年
        const FUTURE_START_YEAR = 2026; // 未来从2026年开始缴
        
        // --- 更新滑块显示值的辅助函数 ---
        function updateSliderValue(id) {
            const value = document.getElementById(id).value;
            let unit = '';
            let precision = 0;
            if (id === 'years' || id === 'birthYear') {
                unit = ' 年';
            } else if (id === 'index') {
                precision = 1;
            } else if (id === 'growth') {
                unit = ' %';
                precision = 1;
            }
            document.getElementById(id + 'Value').innerText = parseFloat(value).toFixed(precision) + unit;
        }

        // --- 核心计算函数 ---
        function calculatePension() {
            // 1. 获取输入值
            const birthYear = parseInt(document.getElementById('birthYear').value);
            const future_years = parseFloat(document.getElementById('years').value); // 未来缴费年限
            const total_years = ALREADY_PAID_YEARS + future_years; // 总缴费年限
            const index = parseFloat(document.getElementById('index').value);
            const growth = parseFloat(document.getElementById('growth').value) / 100; // 转为小数

            // 2. 计算动态年份
            const retirementYear = birthYear + RETIREMENT_AGE;
            const sawYear = retirementYear - 1; // 退休前一年的SAW
            const yearsToRetirement = sawYear - 2024; // 从2024年到SAW年份的年数
            
            // 3. 静态估算 (2025年水平) - 按总年限
            // 基础养老金 = (SAW + SAW * 指数) / 2 * 总年限 * 1%
            const staticBase = (CURRENT_SAW + CURRENT_SAW * index) / 2 * total_years * 0.01;
            // 个人账户养老金 = (SAW * 指数 * 8% * 12 * 总年限) / 计发月数
            // (这是一个简化的“静态”估算，假设缴费基数在所有年份都等于 CURRENT_SAW * index)
            const staticAvgBase = CURRENT_SAW * index;
            const staticPersonalTotal = (staticAvgBase * 0.08 * 12 * total_years);
            const staticPersonalMonthly = staticPersonalTotal / PENSION_FACTOR;
            // 静态总额
            const staticTotal = staticBase + staticPersonalMonthly;

            // 4. 动态估算 - 按总年限
            // 4.1 推算退休前一年的社平工资
            // 增加一个判断，如果退休年份早于2024年，增长年数为负，会导致计算错误
            let projectedSAW;
            if (yearsToRetirement < 0) {
                // 如果退休年份在2024年或更早，我们统一使用当前的SAW，增长率为0
                projectedSAW = CURRENT_SAW;
            } else {
                projectedSAW = CURRENT_SAW * Math.pow(1 + growth, yearsToRetirement);
            }
            
            // 4.2 计算动态基础养老金
            const dynamicBase = (projectedSAW + projectedSAW * index) / 2 * total_years * 0.01;

            // 4.3 计算养老金替代率 (核心)
            // 我们假设动态总额/动态SAW = 静态总额/静态SAW
            // 这是为了保持与原报告结论逻辑一致的简化推演
            const replacementRate = staticTotal / CURRENT_SAW;
            
            // 4.4 计算动态总额
            const dynamicTotal = replacementRate * projectedSAW;

            // 4.5 计算动态个人账户 (倒推)
            // 确保个人账户不为负数（在极端参数下可能发生）
            let dynamicPersonalMonthly = dynamicTotal - dynamicBase;
            if (dynamicPersonalMonthly < 0) {
                dynamicPersonalMonthly = 0; // 保证最低为0
            }

            // 6. 估算总缴费成本 - 只算未来缴费年限
            // 假设缴费是连续的，从 FUTURE_START_YEAR (2026) 开始
            const yearsFrom2024_to_firstYear = FUTURE_START_YEAR - 2024; // = 2
            
            // 计算缴费首年的SAW（无论是在2024年之前还是之后）
            const sawFirstYear = CURRENT_SAW * Math.pow(1 + growth, yearsFrom2024_to_firstYear);
            const baseFirstYear = sawFirstYear * index;
            
            // 缴费首年的年缴费额
            const a1_Ent = baseFirstYear * 12 * RATE_ENTERPRISE;
            const a1_Flex = baseFirstYear * 12 * RATE_FLEXIBLE;

            let totalCostEnterprise, totalCostFlexible;
            
            // 使用等比数列求和公式 - 只计算 future_years
            // 检查增长率是否接近于0，避免除以0
            if (growth < 0.0001) {
                totalCostEnterprise = a1_Ent * future_years;
                totalCostFlexible = a1_Flex * future_years;
            } else {
                const geometricFactor = (Math.pow(1 + growth, future_years) - 1) / growth;
                totalCostEnterprise = a1_Ent * geometricFactor;
                totalCostFlexible = a1_Flex * geometricFactor;
            }

            // 7. 估算回本时间
            let paybackYearsEnt = 0;
            let paybackYearsFlex = 0;

            if (staticTotal > 0.01) { // 避免除以0
                const paybackMonthsEnt = totalCostEnterprise / staticTotal; // 按用户要求，使用 staticTotal
                const paybackMonthsFlex = totalCostFlexible / staticTotal; // 按用户要求，使用 staticTotal
                
                paybackYearsEnt = paybackMonthsEnt / 12;
                paybackYearsFlex = paybackMonthsFlex / 12;
            }


            // 5. 更新UI界面 (已重排序号)
            
            // --- 更新固定假设 ---
            const currentBase = CURRENT_SAW * index;
            document.getElementById('retirementYearText').innerHTML = `退休年份: <strong>${retirementYear}年</strong>`;
            document.getElementById('totalYearsText').innerHTML = `总缴费年限: <strong>${total_years.toFixed(0)} 年</strong>`;
            document.getElementById('currentBaseText').innerHTML = `当前缴费基数 (估算): <strong>${currentBase.toFixed(2)} 元/月</strong>`;

            // --- 更新静态卡片 ---
            document.getElementById('staticTotal').innerText = `${staticTotal.toFixed(2)} 元`;
            document.getElementById('staticBase').innerText = `${staticBase.toFixed(2)} 元/月`;
            document.getElementById('staticPersonal').innerText = `${staticPersonalMonthly.toFixed(2)} 元/月`;

            // --- 更新动态卡片 ---
            document.getElementById('dynamicYearText').innerText = `${retirementYear}`;
            document.getElementById('dynamicSAWYearText').innerText = `${sawYear}`;
            document.getElementById('dynamicSAW').innerText = `~ ${projectedSAW.toFixed(2)} 元/月`;
            document.getElementById('dynamicTotal').innerText = `${dynamicTotal.toFixed(2)} 元`;
            document.getElementById('dynamicBase').innerText = `${dynamicBase.toFixed(2)} 元/月`;
            document.getElementById('dynamicPersonal').innerText = `${dynamicPersonalMonthly.toFixed(2)} 元/月`;

            // --- 更新结论卡片 ---
            const ratePercent = (replacementRate * 100).toFixed(1);
            document.getElementById('replacementRate').innerText = `${ratePercent} %`;
            
            // 更新解读文本
            let interpretationText = `
                <strong>解读：</strong>您在${retirementYear}年领取的 <strong>${dynamicTotal.toFixed(2)} 元</strong>，其购买力大致相当于今天的 <strong>${staticTotal.toFixed(2)} 元</strong>。
                <br>
                这个比率 (${ratePercent}%) 是您养老金水平与社会平均工资的对比。
            `;
            if (ratePercent < 55) {
                interpretationText += ' 国际劳工组织建议的警戒线为55%，当前估算值低于此标准。';
            } else {
                interpretationText += ' 当前估算值高于55%的国际警戒线，能提供较好的退休保障。';
            }
            document.getElementById('interpretation').innerHTML = interpretationText;

            // --- 更新总缴费成本卡片 ---
            document.getElementById('costYears').innerText = future_years.toFixed(0);
            document.getElementById('costIndex').innerText = index.toFixed(1);
            document.getElementById('costGrowth').innerText = (growth * 100).toFixed(1);

            // 格式化为 "xx.x 万"
            document.getElementById('totalCostEnterprise').innerText = `~ ${(totalCostEnterprise / 10000).toFixed(1)} 万`;
            document.getElementById('totalCostFlexible').innerText = `~ ${(totalCostFlexible / 10000).toFixed(1)} 万`;

            // --- 更新回本时间卡片 ---
            document.getElementById('paybackAmount').innerText = staticTotal.toFixed(0); // 更新为 staticTotal
            document.getElementById('paybackEnterprise').innerText = `~ ${paybackYearsEnt.toFixed(1)} 年`;
            document.getElementById('paybackFlexible').innerText = `~ ${paybackYearsFlex.toFixed(1)} 年`;
        }

    </script>
</body>
</html>
